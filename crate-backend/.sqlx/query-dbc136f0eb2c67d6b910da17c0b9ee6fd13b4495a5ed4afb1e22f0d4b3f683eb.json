{
  "db_name": "PostgreSQL",
  "query": "with recursive message_tree as (\n    select\n        id,\n        reply_id,\n        1 as depth\n    from\n        message\n    where\n        ($2::uuid is not null and id = $2::uuid)\n        or ($2::uuid is null and reply_id is null)\n    union all\n    select\n        m.id,\n        m.reply_id,\n        mt.depth + 1\n    from\n        message m\n        join message_tree mt on m.reply_id = mt.id\n    where\n        mt.depth < $3\n),\nranked_messages as (\n    select\n        id,\n        depth,\n        row_number() over (partition by reply_id order by id) as rn\n    from\n        message_tree\n),\nfiltered_messages as (\n    select id\n    from ranked_messages\n    where (depth = 1 or rn <= $4 or $4 is null)\n)\nselect count(*) from filtered_messages where id in (select id from message where channel_id = $1 and deleted_at is null and is_latest)\n",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "count",
        "type_info": "Int8"
      }
    ],
    "parameters": {
      "Left": [
        "Uuid",
        "Uuid",
        "Int4",
        "Int8"
      ]
    },
    "nullable": [
      null
    ]
  },
  "hash": "dbc136f0eb2c67d6b910da17c0b9ee6fd13b4495a5ed4afb1e22f0d4b3f683eb"
}
