{
  "db_name": "PostgreSQL",
  "query": "with\n    thread_viewer as (\n        select thread.id, thread.room_id from thread\n        join room_member on thread.room_id = room_member.room_id\n        where room_member.user_id = $1\n        union\n        select thread.id, thread.room_id from thread\n        join thread_member on thread.id = thread_member.thread_id\n        where thread.room_id is null and thread_member.user_id = $1 and thread_member.membership = 'Join'\n    )\nselect count(*)\nfrom message as msg\njoin thread_viewer on msg.thread_id = thread_viewer.id\nwhere is_latest and msg.deleted_at is null\n  and ($2::text is null or $2 = '' or content @@ websearch_to_tsquery('english', $2))\n  and (cardinality($3::uuid[]) = 0 or thread_viewer.room_id = any($3))\n  and (cardinality($4::uuid[]) = 0 or msg.thread_id = any($4))\n  and (cardinality($5::uuid[]) = 0 or msg.author_id = any($5))\n  -- has_attachment: $6\n  and ($6::boolean is null or (exists (select 1 from message_attachment where version_id = msg.version_id)) = $6)\n  -- has_image: $7\n  and ($7::boolean is null or (exists (select 1 from message_attachment ma join media m on ma.media_id = m.id, jsonb_array_elements(m.data->'tracks') as track where ma.version_id = msg.version_id and track->>'mime' like 'image/%')) = $7)\n  -- has_audio: $8\n  and ($8::boolean is null or (exists (select 1 from message_attachment ma join media m on ma.media_id = m.id, jsonb_array_elements(m.data->'tracks') as track where ma.version_id = msg.version_id and track->>'mime' like 'audio/%')) = $8)\n  -- has_video: $9\n  and ($9::boolean is null or (exists (select 1 from message_attachment ma join media m on ma.media_id = m.id, jsonb_array_elements(m.data->'tracks') as track where ma.version_id = msg.version_id and track->>'mime' like 'video/%')) = $9)\n  -- has_link: $10\n  and ($10::boolean is null or ((content ~ 'https?://[^\\s<>\"]+|www\\.[^\\s<>\"]+') = $10))\n  -- has_embed: $11\n  and ($11::boolean is null or ((jsonb_array_length(coalesce(msg.embeds, '[]'::jsonb)) > 0) = $11))\n  -- pinned: $12\n  and ($12::boolean is null or ((msg.pinned is not null) = $12))\n  -- link_hostnames: $13\n  and (cardinality($13::text[]) = 0 or embed_hosts(msg.embeds) && $13 or content_hosts(msg.content) && $13)\n  -- mentions_users: $14\n  and (cardinality($14::uuid[]) = 0 or (msg.mentions->'users')::jsonb ?| array(select jsonb_array_elements_text(to_jsonb($14::uuid[]))))\n  -- mentions_roles: $15\n  and (cardinality($15::uuid[]) = 0 or (msg.mentions->'roles')::jsonb ?| array(select jsonb_array_elements_text(to_jsonb($15::uuid[]))))\n  -- mentions_everyone_room: $16\n  and ($16::boolean is null or (msg.mentions->>'everyone_room')::boolean = $16)\n  -- mentions_everyone_thread: $17\n  and ($17::boolean is null or (msg.mentions->>'everyone_thread')::boolean = $17)\n",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "count",
        "type_info": "Int8"
      }
    ],
    "parameters": {
      "Left": [
        "Uuid",
        "Text",
        "UuidArray",
        "UuidArray",
        "UuidArray",
        "Bool",
        "Bool",
        "Bool",
        "Bool",
        "Bool",
        "Bool",
        "Bool",
        "TextArray",
        "UuidArray",
        "UuidArray",
        "Bool",
        "Bool"
      ]
    },
    "nullable": [
      null
    ]
  },
  "hash": "681344ce098ffecad6505324931c57eceeadf8d77a430f0cc9df850f1fdd45ed"
}
